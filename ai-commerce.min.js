var AICommerceSDK=(function(exports){'use strict';/*! AI Commerce SDK v1.0.0 | MIT License | https://aicommerce.dev */
var B=Object.defineProperty;var me=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var pe=Object.prototype.hasOwnProperty;var H=(o,r)=>()=>(o&&(r=o(o=0)),r);var G=(o,r)=>{for(var e in r)B(o,e,{get:r[e],enumerable:true});},ue=(o,r,e,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let h of le(r))!pe.call(o,h)&&h!==e&&B(o,h,{get:()=>r[h],enumerable:!(c=me(r,h))||c.enumerable});return o};var j=o=>ue(B({},"__esModule",{value:true}),o);var W={};G(W,{AICommerce:()=>exports.AICommerce,AICommerceError:()=>exports.AICommerceError});exports.AICommerce=void 0;exports.AICommerceError=void 0;var R=H(()=>{exports.AICommerce=class o{constructor(r){this.sessionToken=null;this.products={create:async r=>this.request("/api/v1/products",{method:"POST",body:JSON.stringify(r)}),batchUpsert:async r=>this.request("/api/v1/products",{method:"POST",body:JSON.stringify({products:r})}),list:async r=>{let e=new URLSearchParams;r?.page&&e.set("page",String(r.page)),r?.perPage&&e.set("perPage",String(r.perPage)),r?.search&&e.set("search",r.search),r?.categoryId&&e.set("categoryId",r.categoryId),r?.isActive!==void 0&&e.set("isActive",String(r.isActive));let c=e.toString();return this.request(`/api/v1/products${c?`?${c}`:""}`)},get:async r=>this.request(`/api/v1/products/${r}`),update:async(r,e)=>this.request(`/api/v1/products/${r}`,{method:"PUT",body:JSON.stringify(e)}),delete:async r=>this.request(`/api/v1/products/${r}`,{method:"DELETE"})};if(!r.apiKey)throw new Error("AICommerce: apiKey is required");this.apiKey=r.apiKey,this.storeId=r.storeId,this.baseUrl=this.normalizeUrl(r.baseUrl||this.detectBaseUrl()),this.timeout=r.timeout||3e4;}detectBaseUrl(){if(typeof window<"u"){let r=document.querySelector("script[data-aicommerce-url]");if(r)return r.getAttribute("data-aicommerce-url")||"https://api.aicommerce.dev"}return "https://api.aicommerce.dev"}normalizeUrl(r){return r.replace(/\/$/,"")}async request(r,e={}){let c=`${this.baseUrl}${r}`,h=new AbortController,s=setTimeout(()=>h.abort(),this.timeout);try{let g=await fetch(c,{...e,signal:h.signal,headers:{"Content-Type":"application/json","x-api-key":this.apiKey,...this.storeId&&{"x-store-id":this.storeId},...this.sessionToken&&{"X-Session-Token":this.sessionToken},...e.headers}});if(clearTimeout(s),!g.ok){let L=await g.json().catch(()=>({})),w={code:L.code||"UNKNOWN_ERROR",message:L.message||L.error||`HTTP ${g.status}`,status:g.status};throw new exports.AICommerceError(w.message,w.code,w.status)}return g.json()}catch(g){throw clearTimeout(s),g instanceof exports.AICommerceError?g:g instanceof Error&&g.name==="AbortError"?new exports.AICommerceError("Request timeout","TIMEOUT",408):new exports.AICommerceError(g instanceof Error?g.message:"Unknown error","NETWORK_ERROR",0)}}async chat(r,e){let c=typeof r=="string"?{message:r,context:e,sessionToken:this.sessionToken||void 0}:{...r,sessionToken:r.sessionToken||this.sessionToken||void 0},h=await this.request("/api/v1/chat",{method:"POST",body:JSON.stringify(c)});return h.sessionToken&&(this.sessionToken=h.sessionToken),h}async chatWithAudio(r,e){let c=await r.arrayBuffer(),s={audioBase64:btoa(new Uint8Array(c).reduce((L,w)=>L+String.fromCharCode(w),"")),audioMimeType:r.type||"audio/webm",context:e,sessionToken:this.sessionToken||void 0},g=await this.request("/api/v1/chat",{method:"POST",body:JSON.stringify(s)});return g.sessionToken&&(this.sessionToken=g.sessionToken),g}async createSession(){let r=await this.request("/api/v1/chat/session",{method:"POST"});return this.sessionToken=r.session.token,r.session}clearSession(){this.sessionToken=null;}getSessionToken(){return this.sessionToken}setSessionToken(r){this.sessionToken=r;}async upload(r,e){let c=new FormData;c.append("file",r),e?.folder&&c.append("folder",e.folder),e?.productId&&c.append("productId",e.productId),e?.isPrimary&&c.append("isPrimary","true");let h=`${this.baseUrl}/api/v1/upload`,s=await fetch(h,{method:"POST",headers:{"X-API-Key":this.apiKey},body:c});if(!s.ok){let g=await s.json().catch(()=>({}));throw new exports.AICommerceError(g.message||g.error||`HTTP ${s.status}`,g.code||"UPLOAD_ERROR",s.status)}return s.json()}static async quickChat(r){return new o({apiKey:r.apiKey,baseUrl:r.baseUrl}).chat(r.message,r.context)}},exports.AICommerceError=class o extends Error{constructor(r,e,c){super(r),this.name="AICommerceError",this.code=e,this.status=c,Object.setPrototypeOf(this,o.prototype);}};});function ge(o){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:{r:99,g:102,b:241}}function z(o){let r=o.primaryColor,e=ge(r),c=o.position==="bottom-left";return `
/* AI Commerce Widget Styles */
#aicommerce-widget {
    --aic-primary: ${r};
    --aic-primary-rgb: ${e.r}, ${e.g}, ${e.b};
    --aic-primary-light: rgba(${e.r}, ${e.g}, ${e.b}, 0.1);
    --aic-primary-dark: rgba(${e.r}, ${e.g}, ${e.b}, 0.9);
    --aic-bg: #ffffff;
    --aic-bg-secondary: #f8fafc;
    --aic-text: #1e293b;
    --aic-text-secondary: #64748b;
    --aic-border: #e2e8f0;
    --aic-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    --aic-radius: 16px;
    --aic-z-index: ${o.zIndex};
    
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
    font-size: 14px;
    line-height: 1.5;
    position: fixed;
    bottom: 20px;
    ${c?"left: 20px;":"right: 20px;"}
    z-index: var(--aic-z-index);
}

/* Dark theme */
#aicommerce-widget.aicommerce-theme-dark,
@media (prefers-color-scheme: dark) {
    #aicommerce-widget.aicommerce-theme-auto {
        --aic-bg: #1e293b;
        --aic-bg-secondary: #0f172a;
        --aic-text: #f1f5f9;
        --aic-text-secondary: #94a3b8;
        --aic-border: #334155;
    }
}

/* Launcher Button */
.aicommerce-launcher {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--aic-primary), var(--aic-primary-dark));
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(var(--aic-primary-rgb), 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: aic-pulse 2s infinite;
}

.aicommerce-launcher:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 30px rgba(var(--aic-primary-rgb), 0.5);
}

.aicommerce-launcher-icon {
    font-size: 24px;
}

.aicommerce-hidden {
    display: none !important;
}

@keyframes aic-pulse {
    0%, 100% { box-shadow: 0 4px 20px rgba(var(--aic-primary-rgb), 0.4); }
    50% { box-shadow: 0 4px 30px rgba(var(--aic-primary-rgb), 0.6); }
}

/* Chat Window */
.aicommerce-chat {
    position: absolute;
    bottom: 0;
    ${c?"left: 0;":"right: 0;"}
    width: 380px;
    max-width: calc(100vw - 40px);
    height: 600px;
    max-height: calc(100vh - 100px);
    background: var(--aic-bg);
    border-radius: var(--aic-radius);
    box-shadow: var(--aic-shadow);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: bottom ${c?"left":"right"};
}

.aicommerce-chat.aicommerce-closed {
    opacity: 0;
    transform: scale(0.9) translateY(20px);
    pointer-events: none;
}

.aicommerce-chat.aicommerce-open {
    opacity: 1;
    transform: scale(1) translateY(0);
}

/* Header */
.aicommerce-header {
    background: linear-gradient(135deg, var(--aic-primary), var(--aic-primary-dark));
    color: white;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.aicommerce-header-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.aicommerce-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    overflow: hidden;
}

.aicommerce-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.aicommerce-header-text {
    display: flex;
    flex-direction: column;
}

.aicommerce-bot-name {
    font-weight: 600;
    font-size: 16px;
}

.aicommerce-status {
    font-size: 12px;
    opacity: 0.9;
}

.aicommerce-close {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    transition: background 0.2s;
}

.aicommerce-close:hover {
    background: rgba(255, 255, 255, 0.3);
}

/* Messages */
.aicommerce-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    background: var(--aic-bg-secondary);
}

.aicommerce-message {
    max-width: 85%;
    animation: aic-slide-in 0.3s ease-out;
}

.aicommerce-message.aicommerce-user {
    align-self: flex-end;
}

.aicommerce-message.aicommerce-assistant {
    align-self: flex-start;
}

.aicommerce-message-content {
    padding: 12px 16px;
    border-radius: 16px;
    line-height: 1.5;
}

.aicommerce-user .aicommerce-message-content {
    background: var(--aic-primary);
    color: white;
    border-bottom-right-radius: 4px;
}

.aicommerce-assistant .aicommerce-message-content {
    background: var(--aic-bg);
    color: var(--aic-text);
    border-bottom-left-radius: 4px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

@keyframes aic-slide-in {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Typing Indicator */
.aicommerce-typing {
    display: flex;
    gap: 4px;
    padding: 12px 16px;
    background: var(--aic-bg);
    border-radius: 16px;
    width: fit-content;
}

.aicommerce-typing span {
    width: 8px;
    height: 8px;
    background: var(--aic-text-secondary);
    border-radius: 50%;
    animation: aic-bounce 1.4s infinite ease-in-out;
}

.aicommerce-typing span:nth-child(1) { animation-delay: -0.32s; }
.aicommerce-typing span:nth-child(2) { animation-delay: -0.16s; }

@keyframes aic-bounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
}

/* Product Cards */
.aicommerce-products {
    display: flex;
    gap: 16px;
    margin-top: 12px;
    overflow-x: auto;
    padding-bottom: 16px;
    width: 100%;
    max-width: 100%;
    cursor: grab;
    user-select: none;
    -webkit-user-select: none;
    scrollbar-width: none; /* Firefox */
}
.aicommerce-products::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
}

.aicommerce-product-card {
    flex-shrink: 0;
    width: 280px;
    background: var(--aic-bg);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.aicommerce-product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
}

.aicommerce-product-image {
    width: 100%;
    aspect-ratio: 16/9;
    height: auto;
    object-fit: cover;
}

.aicommerce-product-placeholder {
    width: 100%;
    aspect-ratio: 16/9;
    height: auto;
    background: var(--aic-bg-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
}

.aicommerce-product-info {
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.aicommerce-product-name {
    font-weight: 500;
    font-size: 13px;
    color: var(--aic-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.aicommerce-product-price {
    font-weight: 600;
    font-size: 14px;
    color: var(--aic-primary);
}

.aicommerce-product-desc {
    font-size: 12px;
    color: var(--aic-text-secondary);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-top: 4px;
}

/* Audio Player */
.aicommerce-audio-player {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 240px;
    padding: 4px 0;
}

.aicommerce-audio-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    background: rgba(255, 255, 255, 0.25);
    color: white;
    flex-shrink: 0;
    padding: 0;
}

.aicommerce-audio-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    transform: scale(1.05);
}

.aicommerce-audio-btn:active {
    transform: scale(0.95);
}

/* Invert colors for assistant (since background is white/gray) */
.aicommerce-assistant .aicommerce-audio-btn {
    background: var(--aic-primary);
    color: white;
}
.aicommerce-assistant .aicommerce-audio-btn:hover {
    background: var(--aic-primary-dark);
}

.aicommerce-audio-waveform {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 0; /* Prevent overflow */
}

.aicommerce-waveform-bars {
    display: flex;
    align-items: center;
    gap: 2px;
    height: 24px;
    cursor: pointer;
    width: 100%;
}

.aicommerce-waveform-bar {
    width: 3px;
    border-radius: 2px;
    min-height: 3px;
    transition: background-color 0.1s;
    flex-shrink: 0;
}

.aicommerce-audio-time {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    font-weight: 500;
}

.aicommerce-user .aicommerce-audio-time {
    color: rgba(255, 255, 255, 0.8);
}
.aicommerce-assistant .aicommerce-audio-time {
    color: var(--aic-text-secondary);
}

/* RTL Support */
.aicommerce-rtl {
    direction: rtl;
    text-align: right;
}
.aicommerce-ltr {
    direction: ltr;
    text-align: left;
}

/* Input Area */
.aicommerce-input-container {
    padding: 16px 20px;
    background: var(--aic-bg);
    border-top: 1px solid var(--aic-border);
    display: flex;
    gap: 12px;
}

.aicommerce-input {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid var(--aic-border);
    border-radius: 24px;
    background: var(--aic-bg-secondary);
    color: var(--aic-text);
    font-size: 14px;
    outline: none;
    transition: all 0.2s;
}

.aicommerce-input:focus {
    border-color: var(--aic-primary);
    box-shadow: 0 0 0 3px var(--aic-primary-light);
}

.aicommerce-input::placeholder {
    color: var(--aic-text-secondary);
}

.aicommerce-send {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--aic-primary);
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.aicommerce-send:hover:not(:disabled) {
    background: var(--aic-primary-dark);
    transform: scale(1.05);
}

.aicommerce-send:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* Microphone Button */
.aicommerce-mic {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--aic-bg-secondary);
    border: 1px solid var(--aic-border);
    color: var(--aic-text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.aicommerce-mic:hover:not(:disabled) {
    background: var(--aic-primary-light);
    border-color: var(--aic-primary);
    color: var(--aic-primary);
}

.aicommerce-mic.aicommerce-recording {
    background: #ef4444;
    border-color: #ef4444;
    color: white;
    animation: aic-recording-pulse 1s infinite;
}

.aicommerce-mic:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

@keyframes aic-recording-pulse {
    0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
    50% { transform: scale(1.05); box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
}

/* Mobile Responsive */
@media (max-width: 420px) {
    #aicommerce-widget {
        bottom: 16px;
        ${c?"left: 16px;":"right: 16px;"}
    }
    
    .aicommerce-chat {
        width: calc(100vw - 32px);
        height: calc(100vh - 100px);
        border-radius: 12px;
    }
    
    .aicommerce-launcher {
        width: 56px;
        height: 56px;
    }
}

/* Scrollbar */
.aicommerce-messages::-webkit-scrollbar {
    width: 6px;
}

.aicommerce-messages::-webkit-scrollbar-track {
    background: transparent;
}

.aicommerce-messages::-webkit-scrollbar-thumb {
    background: var(--aic-border);
    border-radius: 3px;
}

.aicommerce-messages::-webkit-scrollbar-thumb:hover {
    background: var(--aic-text-secondary);
}

/* ============================================
   Embedded Mode Styles - ChatGPT Style
   ============================================ */

/* Embedded container - fit content with max height */
#aicommerce-widget.aicommerce-embedded {
    position: relative;
    bottom: auto;
    left: auto;
    right: auto;
    width: 100%;
    height: auto;
    max-height: var(--aic-max-height, 600px);
    display: flex;
    flex-direction: column;
    background: transparent;
}

/* Embedded mode: hide launcher button */
.aicommerce-embedded .aicommerce-launcher {
    display: none !important;
}

/* Embedded mode: hide the header completely */
.aicommerce-embedded .aicommerce-header {
    display: none !important;
}

/* Embedded mode: hide close button */
.aicommerce-embedded .aicommerce-close {
    display: none !important;
}

/* Embedded mode: chat fills container with transparent background */
.aicommerce-embedded .aicommerce-chat {
    position: relative;
    width: 100%;
    height: auto;
    max-width: 100%;
    border-radius: 0;
    background: transparent;
    box-shadow: none;
    transform: none !important;
    opacity: 1 !important;
    pointer-events: auto !important;
    display: flex;
    flex-direction: column;
}

/* Embedded mode: no open/close animations */
.aicommerce-embedded .aicommerce-chat.aicommerce-closed {
    opacity: 1 !important;
    transform: none !important;
    pointer-events: auto !important;
}

/* Embedded mode: messages area - messages start from bottom, grow upward */
.aicommerce-embedded .aicommerce-messages {
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    overflow-y: auto;
    max-height: calc(var(--aic-max-height, 600px) - 100px);
    padding: 16px;
    max-width: 700px;
    margin: 0 auto;
    width: 100%;
    background: transparent;
    gap: 12px;
    scrollbar-width: thin;
    scrollbar-color: var(--aic-border) transparent;
}

/* Embedded mode: custom scrollbar for webkit browsers */
.aicommerce-embedded .aicommerce-messages::-webkit-scrollbar {
    width: 6px;
}

.aicommerce-embedded .aicommerce-messages::-webkit-scrollbar-track {
    background: transparent;
}

.aicommerce-embedded .aicommerce-messages::-webkit-scrollbar-thumb {
    background-color: var(--aic-border);
    border-radius: 3px;
}

.aicommerce-embedded .aicommerce-messages::-webkit-scrollbar-thumb:hover {
    background-color: var(--aic-text-secondary);
}

/* Embedded mode: messages have different styling */
.aicommerce-embedded .aicommerce-message {
    max-width: 100%;
}

.aicommerce-embedded .aicommerce-message-content {
    background: var(--aic-bg);
    border: 1px solid var(--aic-border);
    border-radius: 12px;
    padding: 12px 16px;
}

.aicommerce-embedded .aicommerce-user .aicommerce-message-content {
    background: var(--aic-primary);
    color: white;
    border-color: var(--aic-primary);
}

/* Embedded mode: input container wrapper - always at bottom */
.aicommerce-embedded .aicommerce-input-wrapper {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 16px;
    flex-shrink: 0;
}

/* Embedded mode: input container styled like ChatGPT */
.aicommerce-embedded .aicommerce-input-container {
    width: 100%;
    max-width: 700px;
    background: var(--aic-bg);
    border: 1px solid var(--aic-border);
    border-radius: 24px;
    padding: 8px 12px;
    display: flex;
    align-items: flex-end;
    gap: 8px;
}

/* Embedded mode: textarea field styling - auto-grow */
.aicommerce-embedded .aicommerce-input {
    flex: 1;
    min-width: 0;
    border: none;
    background: transparent;
    padding: 8px 4px;
    font-size: 16px;
    font-family: inherit;
    color: var(--aic-text);
    outline: none;
    resize: none;
    min-height: 24px;
    max-height: 150px;
    line-height: 1.5;
    overflow-y: auto;
}

.aicommerce-embedded .aicommerce-input::placeholder {
    color: var(--aic-text-secondary);
}

/* Embedded mode: buttons styling - smaller, no overflow */
.aicommerce-embedded .aicommerce-mic,
.aicommerce-embedded .aicommerce-send {
    flex-shrink: 0;
    width: 36px;
    height: 36px;
    min-width: 36px;
    border-radius: 50%;
    background: var(--aic-primary);
    color: white;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.aicommerce-embedded .aicommerce-mic:hover,
.aicommerce-embedded .aicommerce-send:hover {
    opacity: 0.9;
}

.aicommerce-embedded .aicommerce-mic {
    background: transparent;
    color: var(--aic-text-secondary);
}

.aicommerce-embedded .aicommerce-mic:hover {
    background: rgba(0, 0, 0, 0.05);
    color: var(--aic-text);
}

/* Embedded mode: product cards styling */
.aicommerce-embedded .aicommerce-products {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 12px;
}

.aicommerce-embedded .aicommerce-product-card {
    background: var(--aic-bg);
    border: 1px solid var(--aic-border);
    border-radius: 12px;
    max-width: 180px;
}

/* Embedded mode: typing indicator */
.aicommerce-embedded .aicommerce-typing {
    background: var(--aic-bg);
    border: 1px solid var(--aic-border);
    border-radius: 12px;
    padding: 12px 16px;
}

/* Embedded mode responsive - mobile fixes */
@media (max-width: 640px) {
    .aicommerce-embedded .aicommerce-input-container {
        padding: 6px 10px;
        gap: 6px;
        border-radius: 20px;
    }
    
    .aicommerce-embedded .aicommerce-mic,
    .aicommerce-embedded .aicommerce-send {
        width: 32px;
        height: 32px;
        min-width: 32px;
    }
    
    .aicommerce-embedded .aicommerce-mic svg,
    .aicommerce-embedded .aicommerce-send svg {
        width: 16px;
        height: 16px;
    }
    
    .aicommerce-embedded .aicommerce-input {
        font-size: 16px;
        padding: 6px 4px;
    }
    
    .aicommerce-embedded .aicommerce-messages {
        padding: 12px;
    }
    
    .aicommerce-embedded .aicommerce-input-wrapper {
        padding: 12px;
    }
}

/* ============================================
   Add to Cart Button Styles
   ============================================ */

.aicommerce-add-to-cart {
    width: 100%;
    padding: 8px 12px;
    background: var(--aic-primary);
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    margin-top: 8px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.aicommerce-add-to-cart:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}

.aicommerce-add-to-cart:active {
    transform: translateY(0);
}

.aicommerce-add-to-cart:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

.aicommerce-add-to-cart svg {
    flex-shrink: 0;
}

/* Spinner animation for loading state */
@keyframes aicommerce-spin {
    to { transform: rotate(360deg); }
}

.aicommerce-spinner {
    animation: aicommerce-spin 1s linear infinite;
}
`}function _(o){let r=document.createElement("style");r.id="aicommerce-widget-styles",r.textContent=o;let e=document.getElementById("aicommerce-widget-styles");return e&&e.remove(),document.head.appendChild(r),r}var Q=H(()=>{});var Z={};G(Z,{AICommerceWidget:()=>exports.AICommerceWidget,createWidget:()=>D});function D(o){if(!o.apiKey)throw new Error("AICommerceWidget: apiKey is required");let r=new exports.AICommerce({apiKey:o.apiKey,storeId:o.storeId,baseUrl:o.baseUrl}),e={isOpen:false,isLoading:true,isRecording:false,messages:[],storeConfig:null},c=null,h=[],s=null,w=null,m;async function ee(){try{let a=o.baseUrl||N(),i=await fetch(`${a}/api/v1/store`,{headers:{"x-api-key":o.apiKey}});return i.ok?(await i.json()).store:null}catch(a){return console.error("Failed to fetch store config:",a),null}}function N(){if(typeof window<"u"){let a=document.querySelector("script[data-aicommerce-url]");if(a)return a.getAttribute("data-aicommerce-url")||""}return "https://api.aicommerce.dev"}async function re(){e.storeConfig=await ee();let a=o.displayMode||"widget",i=a==="embedded";m={apiKey:o.apiKey,storeId:o.storeId,baseUrl:o.baseUrl||N(),displayMode:a,container:o.container,maxHeight:o.maxHeight||"600px",placeholder:o.placeholder||"Ask me anything about our products...",position:o.position||"bottom-right",theme:o.theme||"auto",primaryColor:o.primaryColor||e.storeConfig?.primaryColor||"#6366f1",welcomeMessage:o.welcomeMessage||e.storeConfig?.welcomeMessage||"Hi! How can I help you find the perfect product today?",botName:o.botName||e.storeConfig?.chatBotName||"Shopping Assistant",zIndex:o.zIndex||9999,buttonText:o.buttonText||"\u{1F4AC}",hideLauncher:o.hideLauncher||false,addToCartText:o.addToCartText,onOpen:o.onOpen,onClose:o.onClose,onProductClick:o.onProductClick,onAddToCart:o.onAddToCart,onMessage:o.onMessage};let d=z(m);if(w=_(d),i){let b=null;if(typeof o.container=="string"?b=document.querySelector(o.container):o.container instanceof HTMLElement&&(b=o.container),!b){console.error("[AI Commerce] Embedded mode requires a valid container element or selector");return}s=document.createElement("div"),s.id="aicommerce-widget",s.className=`aicommerce-widget aicommerce-embedded aicommerce-theme-${m.theme}`,s.style.setProperty("--aic-max-height",m.maxHeight),b.appendChild(s),e.isOpen=true;}else s=document.createElement("div"),s.id="aicommerce-widget",s.className=`aicommerce-widget aicommerce-${m.position} aicommerce-theme-${m.theme}`,document.body.appendChild(s);k(),i||e.messages.push({role:"assistant",content:m.welcomeMessage}),e.isLoading=false,k();}async function te(a,i=1){if(!(await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,quantity:i})})).ok)throw new Error("Failed to add to cart");document.dispatchEvent(new CustomEvent("cart:refresh"));}function k(){if(!s)return;let a=m.displayMode==="embedded",i=e.messages.some(l=>l.role==="user");a&&(s.classList.remove("aicommerce-no-messages","aicommerce-has-messages"),s.classList.add(i?"aicommerce-has-messages":"aicommerce-no-messages"));let d=m.placeholder||"Ask me anything about our products...",b=`
            <div class="aicommerce-input-container">
                ${a?`
                <textarea 
                    class="aicommerce-input" 
                    placeholder="${d}"
                    rows="1"
                    ${e.isLoading||e.isRecording?"disabled":""}
                ></textarea>
                `:`
                <input 
                    type="text" 
                    class="aicommerce-input" 
                    placeholder="${d}"
                    ${e.isLoading||e.isRecording?"disabled":""}
                />
                `}
                <button class="aicommerce-mic ${e.isRecording?"aicommerce-recording":""}" ${e.isLoading?"disabled":""} aria-label="${e.isRecording?"Stop recording":"Voice input"}">
                    ${e.isRecording?`
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <rect x="6" y="6" width="12" height="12" rx="2"/>
                        </svg>
                    `:`
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                            <line x1="12" y1="19" x2="12" y2="23"/>
                            <line x1="8" y1="23" x2="16" y2="23"/>
                        </svg>
                    `}
                </button>
                <button class="aicommerce-send" ${e.isLoading||e.isRecording?"disabled":""} aria-label="Send message">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13"/>
                    </svg>
                </button>
            </div>
        `,u=`
            ${!a&&!m.hideLauncher?`
                <button class="aicommerce-launcher ${e.isOpen?"aicommerce-hidden":""}" aria-label="Open chat">
                    <span class="aicommerce-launcher-icon">${m.buttonText}</span>
                </button>
            `:""}
            
            <div class="aicommerce-chat ${e.isOpen?"aicommerce-open":"aicommerce-closed"}">
                ${a?"":`
                <div class="aicommerce-header">
                    <div class="aicommerce-header-info">
                        <div class="aicommerce-avatar">
                            ${e.storeConfig?.logo?`<img src="${e.storeConfig.logo}" alt="${m.botName}" />`:"<span>\u{1F916}</span>"}
                        </div>
                        <div class="aicommerce-header-text">
                            <span class="aicommerce-bot-name">${m.botName}</span>
                            <span class="aicommerce-status">Online</span>
                        </div>
                    </div>
                    <button class="aicommerce-close" aria-label="Close chat">\u2715</button>
                </div>
                `}
                
                ${a&&i?`
                <div class="aicommerce-messages">
                    ${e.messages.map((l,S)=>{let A=J(l.content),n=l.role==="user";return `
                        <div class="aicommerce-message aicommerce-${l.role}">
                            <div class="aicommerce-message-content ${A?"aicommerce-rtl":"aicommerce-ltr"}">
                                ${l.audioUrl?Y(l,S,n):T(l.content)}
                            </div>
                            ${l.products&&l.products.length>0?`
                                <div class="aicommerce-products">
                                    ${l.products.map(t=>`
                                        <div class="aicommerce-product-card" data-product-id="${t.id}">
                                            ${t.image||t.imageUrl?`
                                                <img src="${t.image||t.imageUrl}" alt="${T(t.name)}" class="aicommerce-product-image" />
                                            `:`
                                                <div class="aicommerce-product-placeholder">\u{1F4E6}</div>
                                            `}
                                            <div class="aicommerce-product-info">
                                                <span class="aicommerce-product-name" title="${T(t.name)}">${T(t.name)}</span>
                                                ${t.description?`<p class="aicommerce-product-desc">${T(t.description)}</p>`:""}
                                                <span class="aicommerce-product-price">${X(t.price,t.currency)}</span>
                                            </div>
                                        </div>
                                    `).join("")}
                                </div>
                            `:""}
                        </div>
                    `}).join("")}
                    ${e.isLoading?`
                        <div class="aicommerce-message aicommerce-assistant">
                            <div class="aicommerce-typing">
                                <span></span><span></span><span></span>
                            </div>
                        </div>
                    `:""}
                </div>
                `:""}
                
                ${a?"":`
                <div class="aicommerce-messages">
                    ${e.messages.map((l,S)=>{let A=J(l.content),n=l.role==="user";return `
                        <div class="aicommerce-message aicommerce-${l.role}">
                            <div class="aicommerce-message-content ${A?"aicommerce-rtl":"aicommerce-ltr"}">
                                ${l.audioUrl?Y(l,S,n):T(l.content)}
                            </div>
                            ${l.products&&l.products.length>0?`
                                <div class="aicommerce-products">
                                    ${l.products.map(t=>`
                                        <div class="aicommerce-product-card" data-product-id="${t.id}" data-variant-id="${t.variantId||""}">
                                            ${t.image||t.imageUrl?`
                                                <img src="${t.image||t.imageUrl}" alt="${T(t.name)}" class="aicommerce-product-image" />
                                            `:`
                                                <div class="aicommerce-product-placeholder">\u{1F4E6}</div>
                                            `}
                                            <div class="aicommerce-product-info">
                                                <span class="aicommerce-product-name" title="${T(t.name)}">${T(t.name)}</span>
                                                ${t.description?`<p class="aicommerce-product-desc">${T(t.description)}</p>`:""}
                                                <span class="aicommerce-product-price">${X(t.price,t.currency)}</span>
                                                <button class="aicommerce-add-to-cart" data-product-id="${t.id}">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/>
                                                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                                                    </svg>
                                                    ${m.addToCartText||"Add to Cart"}
                                                </button>
                                            </div>
                                        </div>
                                    `).join("")}
                                </div>
                            `:""}
                        </div>
                    `}).join("")}
                    ${e.isLoading?`
                        <div class="aicommerce-message aicommerce-assistant">
                            <div class="aicommerce-typing">
                                <span></span><span></span><span></span>
                            </div>
                        </div>
                    `:""}
                </div>
                `}
                
                ${a?`
                <div class="aicommerce-input-wrapper">
                    ${b}
                </div>
                `:b}
            </div>
        `;s.innerHTML=u,oe();let E=s.querySelector(".aicommerce-messages");E&&(E.scrollTop=E.scrollHeight);}function Y(a,i,d){return `
            <div class="aicommerce-audio-player" data-message-index="${i}">
                <button class="aicommerce-audio-btn">
                     <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                </button>
                <div class="aicommerce-audio-waveform">
                    <div class="aicommerce-waveform-bars">
                        ${(a.waveformBars||Array(40).fill(10)).map(b=>`
                            <div class="aicommerce-waveform-bar" style="height: ${b}%; background-color: ${d?"rgba(255,255,255,0.4)":"rgba(99,102,241,0.3)"}"></div>
                        `).join("")}
                    </div>
                    <div class="aicommerce-audio-time">
                        <span class="aicommerce-current-time">0:00</span>
                        <span>${V(a.audioDuration||0)}</span>
                    </div>
                </div>
                <audio src="${a.audioUrl}" preload="metadata"></audio>
            </div>
        `}function oe(){if(!s)return;let a=s.querySelector(".aicommerce-launcher");a&&a.addEventListener("click",()=>q());let i=s.querySelector(".aicommerce-close");i&&i.addEventListener("click",()=>O());let d=s.querySelector(".aicommerce-input"),b=s.querySelector(".aicommerce-send");d&&(d.addEventListener("keydown",n=>{let t=n;if(t.key==="Enter"){let p=d instanceof HTMLTextAreaElement;if(p&&t.shiftKey)return;n.preventDefault();let f=d.value.trim();f&&(U(f),d.value="",p&&(d.style.height="auto"));}}),d instanceof HTMLTextAreaElement&&d.addEventListener("input",()=>{d.style.height="auto",d.style.height=Math.min(d.scrollHeight,150)+"px";})),b&&d&&b.addEventListener("click",()=>{let n=d.value.trim();n&&(U(n),d.value="",d instanceof HTMLTextAreaElement&&(d.style.height="auto"));});let u=s.querySelector(".aicommerce-mic");u&&u.addEventListener("click",()=>ae()),s.querySelectorAll(".aicommerce-product-card").forEach(n=>{n.addEventListener("click",t=>{if(t.target.closest(".aicommerce-add-to-cart"))return;let p=n.getAttribute("data-product-id"),f=e.messages.flatMap(y=>y.products||[]).find(y=>y.id===p);f&&(m.onProductClick?m.onProductClick(f):f.url&&window.open(f.url,"_blank","noopener,noreferrer"));});}),s.querySelectorAll(".aicommerce-add-to-cart").forEach(n=>{n.addEventListener("click",async t=>{t.stopPropagation();let p=n,f=p.closest(".aicommerce-product-card"),y=f?.getAttribute("data-product-id"),x=f?.getAttribute("data-variant-id"),C=e.messages.flatMap(P=>P.products||[]).find(P=>P.id===y);if(!C)return;let v=p.innerHTML;p.disabled=true,p.innerHTML=`
                    <svg class="aicommerce-spinner" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" stroke-dasharray="32" stroke-dashoffset="32"/>
                    </svg>
                    Adding...
                `;try{m.onAddToCart?await m.onAddToCart(C):x&&window.Shopify?await te(x):C.url&&window.open(C.url,"_blank","noopener,noreferrer"),p.innerHTML=`
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                        Added!
                    `,setTimeout(()=>{p.innerHTML=v,p.disabled=!1;},2e3);}catch(P){console.error("[AI Commerce] Add to cart failed:",P),p.innerHTML=v,p.disabled=false;}});}),s.querySelectorAll(".aicommerce-products").forEach(n=>{let t=false,p=0,f=0;n.addEventListener("mousedown",y=>{t=true,n.style.cursor="grabbing",p=y.pageX-n.offsetLeft,f=n.scrollLeft;}),n.addEventListener("mouseleave",()=>{t=false,n.style.cursor="grab";}),n.addEventListener("mouseup",()=>{t=false,n.style.cursor="grab";}),n.addEventListener("mousemove",y=>{if(!t)return;y.preventDefault();let C=(y.pageX-n.offsetLeft-p)*2;n.scrollLeft=f-C;});}),s.querySelectorAll(".aicommerce-audio-player").forEach(n=>{let t=n.querySelector("audio"),p=n.querySelector(".aicommerce-audio-btn"),f=n.querySelectorAll(".aicommerce-waveform-bar"),y=n.querySelector(".aicommerce-current-time");if(!t||!p)return;p.addEventListener("click",()=>{!t.paused?(t.pause(),p.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>'):(s?.querySelectorAll("audio").forEach(v=>{if(v!==t&&!v.paused){v.pause();let M=v.closest(".aicommerce-audio-player")?.querySelector(".aicommerce-audio-btn");M&&(M.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>');}}),t.play(),p.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>');}),t.addEventListener("timeupdate",()=>{if(y&&(y.textContent=V(t.currentTime)),t.duration){let C=t.currentTime/t.duration*100;f.forEach((v,P)=>{P/f.length*100<=C?v.style.backgroundColor=n.closest(".aicommerce-user")?"rgba(255,255,255,1)":"var(--aic-primary)":v.style.backgroundColor=n.closest(".aicommerce-user")?"rgba(255,255,255,0.4)":"rgba(99,102,241,0.3)";});}}),t.addEventListener("ended",()=>{p.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>';});let x=n.querySelector(".aicommerce-waveform-bars");x&&x.addEventListener("click",C=>{let v=x.getBoundingClientRect(),M=(C.clientX-v.left)/v.width;t.duration&&(t.currentTime=M*t.duration);});});}async function ae(){if(e.isRecording)c&&c.state!=="inactive"&&c.stop();else try{let a=await navigator.mediaDevices.getUserMedia({audio:!0});h=[],c=new MediaRecorder(a,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),c.ondataavailable=i=>{i.data.size>0&&h.push(i.data);},c.onstop=async()=>{if(a.getTracks().forEach(i=>i.stop()),h.length>0){let i=new Blob(h,{type:c?.mimeType||"audio/webm"});await ie(i);}e.isRecording=!1,k();},c.start(),e.isRecording=!0,k();}catch(a){console.error("Failed to start recording:",a),e.messages.push({role:"assistant",content:"Unable to access microphone. Please check your permissions."}),k();}}async function ie(a){let i=URL.createObjectURL(a),d=Array(40).fill(10),b=0;try{d=await se(a);let u=new Audio(i);await new Promise(E=>{u.onloadedmetadata=()=>{b=u.duration,E();},u.onerror=()=>E();});}catch(u){console.error("Audio analysis failed",u);}e.messages.push({role:"user",content:"Voice message",audioUrl:i,audioDuration:b,waveformBars:d}),e.isLoading=true,k();try{let u=await r.chatWithAudio(a);return e.messages.push({role:"assistant",content:u.reply,products:u.products}),m.onMessage&&m.onMessage("Voice message",u),u}catch(u){throw e.messages.push({role:"assistant",content:"Sorry, I encountered an error processing your voice message. Please try again."}),u}finally{e.isLoading=false,k();}}function J(a){return /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/.test(a)}function V(a){let i=Math.floor(a/60),d=Math.floor(a%60);return `${i}:${d.toString().padStart(2,"0")}`}async function se(a){try{let i=new(window.AudioContext||window.webkitAudioContext),d=await a.arrayBuffer(),u=(await i.decodeAudioData(d)).getChannelData(0),E=40,l=Math.floor(u.length/E),S=[];for(let A=0;A<E;A++){let n=A*l,t=n+l,p=0;for(let x=n;x<t;x++)u[x]&&(p+=u[x]*u[x]);let f=Math.sqrt(p/l),y=Math.min(100,Math.max(10,f*400));S.push(y);}return S}catch(i){return console.error("Analysis error",i),Array.from({length:40},()=>20+Math.random()*60)}}async function U(a){e.messages.push({role:"user",content:a}),e.isLoading=true,k();try{let i=await r.chat(a);return e.messages.push({role:"assistant",content:i.reply,products:i.products}),m.onMessage&&m.onMessage(a,i),i}catch(i){throw e.messages.push({role:"assistant",content:"Sorry, I encountered an error. Please try again."}),i}finally{e.isLoading=false,k();}}function q(){e.isOpen=true,k(),m.onOpen?.(),setTimeout(()=>{s?.querySelector(".aicommerce-input")?.focus();},100);}function O(){e.isOpen=false,k(),m.onClose?.();}function ne(){e.isOpen?O():q();}function ce(){s&&(s.remove(),s=null),w&&(w.remove(),w=null);}function de(a){if(Object.assign(m,a),a.primaryColor){let i=z(m);w&&(w.textContent=i);}k();}function T(a){let i=document.createElement("div");return i.textContent=a,i.innerHTML}function X(a,i){let b={USD:"$",EUR:"\u20AC",GBP:"\xA3",MAD:"DH",SAR:"SAR",AED:"AED",JPY:"\xA5",CNY:"\xA5"}[i||"USD"]||i||"$";return `${a.toFixed(2)} ${b}`}return re(),{open:q,close:O,toggle:ne,destroy:ce,sendMessage:U,updateConfig:de}}exports.AICommerceWidget=void 0;var K=H(()=>{R();Q();exports.AICommerceWidget={init:D,VERSION:"1.0.0"};typeof window<"u"&&(window.AICommerceWidget=exports.AICommerceWidget);});R();K();var xe="1.0.0";typeof window<"u"&&(window.AICommerce=(R(),j(W)).AICommerce,window.AICommerceError=(R(),j(W)).AICommerceError,window.AICommerceWidget=(K(),j(Z)).AICommerceWidget);exports.VERSION=xe;exports.createWidget=D;return exports;})({});//# sourceMappingURL=index.min.js.map
//# sourceMappingURL=index.min.js.map