var AICommerceSDK=(function(exports){'use strict';/*! AI Commerce SDK v1.0.0 | MIT License | https://aicommerce.dev */
var O=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var me=Object.prototype.hasOwnProperty;var B=(t,e)=>()=>(t&&(e=t(t=0)),e);var Y=(t,e)=>{for(var r in e)O(t,r,{get:e[r],enumerable:true});},le=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let g of de(e))!me.call(t,g)&&g!==r&&O(t,g,{get:()=>e[g],enumerable:!(s=ce(e,g))||s.enumerable});return t};var W=t=>le(O({},"__esModule",{value:true}),t);var D={};Y(D,{AICommerce:()=>exports.AICommerce,AICommerceError:()=>exports.AICommerceError});exports.AICommerce=void 0;exports.AICommerceError=void 0;var L=B(()=>{exports.AICommerce=class t{constructor(e){this.sessionToken=null;this.products={create:async e=>this.request("/api/v1/products",{method:"POST",body:JSON.stringify(e)}),batchUpsert:async e=>this.request("/api/v1/products",{method:"POST",body:JSON.stringify({products:e})}),list:async e=>{let r=new URLSearchParams;e?.page&&r.set("page",String(e.page)),e?.perPage&&r.set("perPage",String(e.perPage)),e?.search&&r.set("search",e.search),e?.categoryId&&r.set("categoryId",e.categoryId),e?.isActive!==void 0&&r.set("isActive",String(e.isActive));let s=r.toString();return this.request(`/api/v1/products${s?`?${s}`:""}`)},get:async e=>this.request(`/api/v1/products/${e}`),update:async(e,r)=>this.request(`/api/v1/products/${e}`,{method:"PUT",body:JSON.stringify(r)}),delete:async e=>this.request(`/api/v1/products/${e}`,{method:"DELETE"})};if(!e.apiKey)throw new Error("AICommerce: apiKey is required");this.apiKey=e.apiKey,this.storeId=e.storeId,this.baseUrl=this.normalizeUrl(e.baseUrl||this.detectBaseUrl()),this.timeout=e.timeout||3e4;}detectBaseUrl(){if(typeof window<"u"){let e=document.querySelector("script[data-aicommerce-url]");if(e)return e.getAttribute("data-aicommerce-url")||"https://api.aicommerce.dev"}return "https://api.aicommerce.dev"}normalizeUrl(e){return e.replace(/\/$/,"")}async request(e,r={}){let s=`${this.baseUrl}${e}`,g=new AbortController,a=setTimeout(()=>g.abort(),this.timeout);try{let p=await fetch(s,{...r,signal:g.signal,headers:{"Content-Type":"application/json","x-api-key":this.apiKey,...this.storeId&&{"x-store-id":this.storeId},...this.sessionToken&&{"X-Session-Token":this.sessionToken},...r.headers}});if(clearTimeout(a),!p.ok){let E=await p.json().catch(()=>({})),b={code:E.code||"UNKNOWN_ERROR",message:E.message||E.error||`HTTP ${p.status}`,status:p.status};throw new exports.AICommerceError(b.message,b.code,b.status)}return p.json()}catch(p){throw clearTimeout(a),p instanceof exports.AICommerceError?p:p instanceof Error&&p.name==="AbortError"?new exports.AICommerceError("Request timeout","TIMEOUT",408):new exports.AICommerceError(p instanceof Error?p.message:"Unknown error","NETWORK_ERROR",0)}}async chat(e,r){let s=typeof e=="string"?{message:e,context:r,sessionToken:this.sessionToken||void 0}:{...e,sessionToken:e.sessionToken||this.sessionToken||void 0},g=await this.request("/api/v1/chat",{method:"POST",body:JSON.stringify(s)});return g.sessionToken&&(this.sessionToken=g.sessionToken),g}async chatWithAudio(e,r){let s=await e.arrayBuffer(),a={audioBase64:btoa(new Uint8Array(s).reduce((E,b)=>E+String.fromCharCode(b),"")),audioMimeType:e.type||"audio/webm",context:r,sessionToken:this.sessionToken||void 0},p=await this.request("/api/v1/chat",{method:"POST",body:JSON.stringify(a)});return p.sessionToken&&(this.sessionToken=p.sessionToken),p}async createSession(){let e=await this.request("/api/v1/chat/session",{method:"POST"});return this.sessionToken=e.session.token,e.session}clearSession(){this.sessionToken=null;}getSessionToken(){return this.sessionToken}setSessionToken(e){this.sessionToken=e;}async upload(e,r){let s=new FormData;s.append("file",e),r?.folder&&s.append("folder",r.folder),r?.productId&&s.append("productId",r.productId),r?.isPrimary&&s.append("isPrimary","true");let g=`${this.baseUrl}/api/v1/upload`,a=await fetch(g,{method:"POST",headers:{"X-API-Key":this.apiKey},body:s});if(!a.ok){let p=await a.json().catch(()=>({}));throw new exports.AICommerceError(p.message||p.error||`HTTP ${a.status}`,p.code||"UPLOAD_ERROR",a.status)}return a.json()}static async quickChat(e){return new t({apiKey:e.apiKey,baseUrl:e.baseUrl}).chat(e.message,e.context)}},exports.AICommerceError=class t extends Error{constructor(e,r,s){super(e),this.name="AICommerceError",this.code=r,this.status=s,Object.setPrototypeOf(this,t.prototype);}};});function ue(t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:99,g:102,b:241}}function H(t){let e=t.primaryColor,r=ue(e),s=t.position==="bottom-left";return `
/* AI Commerce Widget Styles */
#aicommerce-widget {
    --aic-primary: ${e};
    --aic-primary-rgb: ${r.r}, ${r.g}, ${r.b};
    --aic-primary-light: rgba(${r.r}, ${r.g}, ${r.b}, 0.1);
    --aic-primary-dark: rgba(${r.r}, ${r.g}, ${r.b}, 0.9);
    --aic-bg: #ffffff;
    --aic-bg-secondary: #f8fafc;
    --aic-text: #1e293b;
    --aic-text-secondary: #64748b;
    --aic-border: #e2e8f0;
    --aic-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    --aic-radius: 16px;
    --aic-z-index: ${t.zIndex};
    
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
    font-size: 14px;
    line-height: 1.5;
    position: fixed;
    bottom: 20px;
    ${s?"left: 20px;":"right: 20px;"}
    z-index: var(--aic-z-index);
}

/* Dark theme */
#aicommerce-widget.aicommerce-theme-dark,
@media (prefers-color-scheme: dark) {
    #aicommerce-widget.aicommerce-theme-auto {
        --aic-bg: #1e293b;
        --aic-bg-secondary: #0f172a;
        --aic-text: #f1f5f9;
        --aic-text-secondary: #94a3b8;
        --aic-border: #334155;
    }
}

/* Launcher Button */
.aicommerce-launcher {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--aic-primary), var(--aic-primary-dark));
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(var(--aic-primary-rgb), 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: aic-pulse 2s infinite;
}

.aicommerce-launcher:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 30px rgba(var(--aic-primary-rgb), 0.5);
}

.aicommerce-launcher-icon {
    font-size: 24px;
}

.aicommerce-hidden {
    display: none !important;
}

@keyframes aic-pulse {
    0%, 100% { box-shadow: 0 4px 20px rgba(var(--aic-primary-rgb), 0.4); }
    50% { box-shadow: 0 4px 30px rgba(var(--aic-primary-rgb), 0.6); }
}

/* Chat Window */
.aicommerce-chat {
    position: absolute;
    bottom: 0;
    ${s?"left: 0;":"right: 0;"}
    width: 380px;
    max-width: calc(100vw - 40px);
    height: 600px;
    max-height: calc(100vh - 100px);
    background: var(--aic-bg);
    border-radius: var(--aic-radius);
    box-shadow: var(--aic-shadow);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: bottom ${s?"left":"right"};
}

.aicommerce-chat.aicommerce-closed {
    opacity: 0;
    transform: scale(0.9) translateY(20px);
    pointer-events: none;
}

.aicommerce-chat.aicommerce-open {
    opacity: 1;
    transform: scale(1) translateY(0);
}

/* Header */
.aicommerce-header {
    background: linear-gradient(135deg, var(--aic-primary), var(--aic-primary-dark));
    color: white;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.aicommerce-header-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.aicommerce-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    overflow: hidden;
}

.aicommerce-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.aicommerce-header-text {
    display: flex;
    flex-direction: column;
}

.aicommerce-bot-name {
    font-weight: 600;
    font-size: 16px;
}

.aicommerce-status {
    font-size: 12px;
    opacity: 0.9;
}

.aicommerce-close {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    transition: background 0.2s;
}

.aicommerce-close:hover {
    background: rgba(255, 255, 255, 0.3);
}

/* Messages */
.aicommerce-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    background: var(--aic-bg-secondary);
}

.aicommerce-message {
    max-width: 85%;
    animation: aic-slide-in 0.3s ease-out;
}

.aicommerce-message.aicommerce-user {
    align-self: flex-end;
}

.aicommerce-message.aicommerce-assistant {
    align-self: flex-start;
}

.aicommerce-message-content {
    padding: 12px 16px;
    border-radius: 16px;
    line-height: 1.5;
}

.aicommerce-user .aicommerce-message-content {
    background: var(--aic-primary);
    color: white;
    border-bottom-right-radius: 4px;
}

.aicommerce-assistant .aicommerce-message-content {
    background: var(--aic-bg);
    color: var(--aic-text);
    border-bottom-left-radius: 4px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

@keyframes aic-slide-in {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Typing Indicator */
.aicommerce-typing {
    display: flex;
    gap: 4px;
    padding: 12px 16px;
    background: var(--aic-bg);
    border-radius: 16px;
    width: fit-content;
}

.aicommerce-typing span {
    width: 8px;
    height: 8px;
    background: var(--aic-text-secondary);
    border-radius: 50%;
    animation: aic-bounce 1.4s infinite ease-in-out;
}

.aicommerce-typing span:nth-child(1) { animation-delay: -0.32s; }
.aicommerce-typing span:nth-child(2) { animation-delay: -0.16s; }

@keyframes aic-bounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
}

/* Product Cards */
.aicommerce-products {
    display: flex;
    gap: 16px;
    margin-top: 12px;
    overflow-x: auto;
    padding-bottom: 16px;
    width: 100%;
    max-width: 100%;
    cursor: grab;
    user-select: none;
    -webkit-user-select: none;
    scrollbar-width: none; /* Firefox */
}
.aicommerce-products::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
}

.aicommerce-product-card {
    flex-shrink: 0;
    width: 280px;
    background: var(--aic-bg);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.aicommerce-product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
}

.aicommerce-product-image {
    width: 100%;
    aspect-ratio: 16/9;
    height: auto;
    object-fit: cover;
}

.aicommerce-product-placeholder {
    width: 100%;
    aspect-ratio: 16/9;
    height: auto;
    background: var(--aic-bg-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
}

.aicommerce-product-info {
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.aicommerce-product-name {
    font-weight: 500;
    font-size: 13px;
    color: var(--aic-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.aicommerce-product-price {
    font-weight: 600;
    font-size: 14px;
    color: var(--aic-primary);
}

.aicommerce-product-desc {
    font-size: 12px;
    color: var(--aic-text-secondary);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-top: 4px;
}

/* Audio Player */
.aicommerce-audio-player {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 240px;
    padding: 4px 0;
}

.aicommerce-audio-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    background: rgba(255, 255, 255, 0.25);
    color: white;
    flex-shrink: 0;
    padding: 0;
}

.aicommerce-audio-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    transform: scale(1.05);
}

.aicommerce-audio-btn:active {
    transform: scale(0.95);
}

/* Invert colors for assistant (since background is white/gray) */
.aicommerce-assistant .aicommerce-audio-btn {
    background: var(--aic-primary);
    color: white;
}
.aicommerce-assistant .aicommerce-audio-btn:hover {
    background: var(--aic-primary-dark);
}

.aicommerce-audio-waveform {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 0; /* Prevent overflow */
}

.aicommerce-waveform-bars {
    display: flex;
    align-items: center;
    gap: 2px;
    height: 24px;
    cursor: pointer;
    width: 100%;
}

.aicommerce-waveform-bar {
    width: 3px;
    border-radius: 2px;
    min-height: 3px;
    transition: background-color 0.1s;
    flex-shrink: 0;
}

.aicommerce-audio-time {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    font-weight: 500;
}

.aicommerce-user .aicommerce-audio-time {
    color: rgba(255, 255, 255, 0.8);
}
.aicommerce-assistant .aicommerce-audio-time {
    color: var(--aic-text-secondary);
}

/* RTL Support */
.aicommerce-rtl {
    direction: rtl;
    text-align: right;
}
.aicommerce-ltr {
    direction: ltr;
    text-align: left;
}

/* Input Area */
.aicommerce-input-container {
    padding: 16px 20px;
    background: var(--aic-bg);
    border-top: 1px solid var(--aic-border);
    display: flex;
    gap: 12px;
}

.aicommerce-input {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid var(--aic-border);
    border-radius: 24px;
    background: var(--aic-bg-secondary);
    color: var(--aic-text);
    font-size: 14px;
    outline: none;
    transition: all 0.2s;
}

.aicommerce-input:focus {
    border-color: var(--aic-primary);
    box-shadow: 0 0 0 3px var(--aic-primary-light);
}

.aicommerce-input::placeholder {
    color: var(--aic-text-secondary);
}

.aicommerce-send {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--aic-primary);
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.aicommerce-send:hover:not(:disabled) {
    background: var(--aic-primary-dark);
    transform: scale(1.05);
}

.aicommerce-send:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* Microphone Button */
.aicommerce-mic {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--aic-bg-secondary);
    border: 1px solid var(--aic-border);
    color: var(--aic-text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.aicommerce-mic:hover:not(:disabled) {
    background: var(--aic-primary-light);
    border-color: var(--aic-primary);
    color: var(--aic-primary);
}

.aicommerce-mic.aicommerce-recording {
    background: #ef4444;
    border-color: #ef4444;
    color: white;
    animation: aic-recording-pulse 1s infinite;
}

.aicommerce-mic:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

@keyframes aic-recording-pulse {
    0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
    50% { transform: scale(1.05); box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
}

/* Mobile Responsive */
@media (max-width: 420px) {
    #aicommerce-widget {
        bottom: 16px;
        ${s?"left: 16px;":"right: 16px;"}
    }
    
    .aicommerce-chat {
        width: calc(100vw - 32px);
        height: calc(100vh - 100px);
        border-radius: 12px;
    }
    
    .aicommerce-launcher {
        width: 56px;
        height: 56px;
    }
}

/* Scrollbar */
.aicommerce-messages::-webkit-scrollbar {
    width: 6px;
}

.aicommerce-messages::-webkit-scrollbar-track {
    background: transparent;
}

.aicommerce-messages::-webkit-scrollbar-thumb {
    background: var(--aic-border);
    border-radius: 3px;
}

.aicommerce-messages::-webkit-scrollbar-thumb:hover {
    background: var(--aic-text-secondary);
}

/* ============================================
   Embedded Mode Styles
   ============================================ */

/* Embedded container - position relative, inline flow */
#aicommerce-widget.aicommerce-embedded {
    position: relative;
    bottom: auto;
    left: auto;
    right: auto;
    width: 100%;
    height: var(--aic-height, 500px);
}

/* Embedded mode: hide launcher button */
.aicommerce-embedded .aicommerce-launcher {
    display: none !important;
}

/* Embedded mode: chat is always visible and fills container */
.aicommerce-embedded .aicommerce-chat {
    position: relative;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    border-radius: var(--aic-radius);
    transform: none !important;
    opacity: 1 !important;
    pointer-events: auto !important;
}

/* Embedded mode: no open/close animations */
.aicommerce-embedded .aicommerce-chat.aicommerce-closed {
    opacity: 1 !important;
    transform: none !important;
    pointer-events: auto !important;
}

/* Embedded mode: messages area adjusts to container */
.aicommerce-embedded .aicommerce-messages {
    flex: 1;
    min-height: 0;
}

/* Embedded mode responsive */
@media (max-width: 420px) {
    #aicommerce-widget.aicommerce-embedded {
        height: var(--aic-height, 400px);
    }
    
    .aicommerce-embedded .aicommerce-chat {
        border-radius: 12px;
    }
}
`}function J(t){let e=document.createElement("style");e.id="aicommerce-widget-styles",e.textContent=t;let r=document.getElementById("aicommerce-widget-styles");return r&&r.remove(),document.head.appendChild(e),e}var V=B(()=>{});var X={};Y(X,{AICommerceWidget:()=>exports.AICommerceWidget,createWidget:()=>j});function j(t){if(!t.apiKey)throw new Error("AICommerceWidget: apiKey is required");let e=new exports.AICommerce({apiKey:t.apiKey,storeId:t.storeId,baseUrl:t.baseUrl}),r={isOpen:false,isLoading:true,isRecording:false,messages:[],storeConfig:null},s=null,g=[],a=null,b=null,l;async function _(){try{let o=t.baseUrl||N(),i=await fetch(`${o}/api/v1/store`,{headers:{"x-api-key":t.apiKey}});return i.ok?(await i.json()).store:null}catch(o){return console.error("Failed to fetch store config:",o),null}}function N(){if(typeof window<"u"){let o=document.querySelector("script[data-aicommerce-url]");if(o)return o.getAttribute("data-aicommerce-url")||""}return "https://api.aicommerce.dev"}async function G(){r.storeConfig=await _();let o=t.displayMode||"widget",i=o==="embedded";l={apiKey:t.apiKey,storeId:t.storeId,baseUrl:t.baseUrl||N(),displayMode:o,container:t.container,height:t.height||"500px",position:t.position||"bottom-right",theme:t.theme||"auto",primaryColor:t.primaryColor||r.storeConfig?.primaryColor||"#6366f1",welcomeMessage:t.welcomeMessage||r.storeConfig?.welcomeMessage||"Hi! How can I help you find the perfect product today?",botName:t.botName||r.storeConfig?.chatBotName||"Shopping Assistant",zIndex:t.zIndex||9999,buttonText:t.buttonText||"\u{1F4AC}",hideLauncher:t.hideLauncher||false,onOpen:t.onOpen,onClose:t.onClose,onProductClick:t.onProductClick,onMessage:t.onMessage};let c=H(l);if(b=J(c),i){let d=null;if(typeof t.container=="string"?d=document.querySelector(t.container):t.container instanceof HTMLElement&&(d=t.container),!d){console.error("[AI Commerce] Embedded mode requires a valid container element or selector");return}a=document.createElement("div"),a.id="aicommerce-widget",a.className=`aicommerce-widget aicommerce-embedded aicommerce-theme-${l.theme}`,a.style.setProperty("--aic-height",l.height),d.appendChild(a),r.isOpen=true;}else a=document.createElement("div"),a.id="aicommerce-widget",a.className=`aicommerce-widget aicommerce-${l.position} aicommerce-theme-${l.theme}`,document.body.appendChild(a);y(),r.messages.push({role:"assistant",content:l.welcomeMessage}),r.isLoading=false,y();}function y(){if(!a)return;let o=l.displayMode==="embedded",i=`
            ${!o&&!l.hideLauncher?`
                <button class="aicommerce-launcher ${r.isOpen?"aicommerce-hidden":""}" aria-label="Open chat">
                    <span class="aicommerce-launcher-icon">${l.buttonText}</span>
                </button>
            `:""}
            
            <div class="aicommerce-chat ${r.isOpen?"aicommerce-open":"aicommerce-closed"}">
                <div class="aicommerce-header">
                    <div class="aicommerce-header-info">
                        <div class="aicommerce-avatar">
                            ${r.storeConfig?.logo?`<img src="${r.storeConfig.logo}" alt="${l.botName}" />`:"<span>\u{1F916}</span>"}
                        </div>
                        <div class="aicommerce-header-text">
                            <span class="aicommerce-bot-name">${l.botName}</span>
                            <span class="aicommerce-status">Online</span>
                        </div>
                    </div>
                    ${o?"":'<button class="aicommerce-close" aria-label="Close chat">\u2715</button>'}
                </div>
                
                <div class="aicommerce-messages">
                    ${r.messages.map((d,u)=>{let P=te(d.content),T=d.role==="user";return `
                        <div class="aicommerce-message aicommerce-${d.role}">
                            <div class="aicommerce-message-content ${P?"aicommerce-rtl":"aicommerce-ltr"}">
                                ${d.audioUrl?Q(d,u,T):R(d.content)}
                            </div>
                            ${d.products&&d.products.length>0?`
                                <div class="aicommerce-products">
                                    ${d.products.map(h=>`
                                        <div class="aicommerce-product-card" data-product-id="${h.id}">
                                            ${h.image||h.imageUrl?`
                                                <img src="${h.image||h.imageUrl}" alt="${R(h.name)}" class="aicommerce-product-image" />
                                            `:`
                                                <div class="aicommerce-product-placeholder">\u{1F4E6}</div>
                                            `}
                                            <div class="aicommerce-product-info">
                                                <span class="aicommerce-product-name" title="${R(h.name)}">${R(h.name)}</span>
                                                ${h.description?`<p class="aicommerce-product-desc">${R(h.description)}</p>`:""}
                                                <span class="aicommerce-product-price">${ne(h.price,h.currency)}</span>
                                            </div>
                                        </div>
                                    `).join("")}
                                </div>
                            `:""}
                        </div>
                    `}).join("")}
                    ${r.isLoading?`
                        <div class="aicommerce-message aicommerce-assistant">
                            <div class="aicommerce-typing">
                                <span></span><span></span><span></span>
                            </div>
                        </div>
                    `:""}
                </div>
                
                <div class="aicommerce-input-container">
                    <input 
                        type="text" 
                        class="aicommerce-input" 
                        placeholder="Type your message..."
                        ${r.isLoading||r.isRecording?"disabled":""}
                    />
                    <button class="aicommerce-mic ${r.isRecording?"aicommerce-recording":""}" ${r.isLoading?"disabled":""} aria-label="${r.isRecording?"Stop recording":"Voice input"}">
                        ${r.isRecording?`
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <rect x="6" y="6" width="12" height="12" rx="2"/>
                            </svg>
                        `:`
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                                <line x1="12" y1="19" x2="12" y2="23"/>
                                <line x1="8" y1="23" x2="16" y2="23"/>
                            </svg>
                        `}
                    </button>
                    <button class="aicommerce-send" ${r.isLoading||r.isRecording?"disabled":""} aria-label="Send message">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13"/>
                        </svg>
                    </button>
                </div>
            </div>
        `;a.innerHTML=i,Z();let c=a.querySelector(".aicommerce-messages");c&&(c.scrollTop=c.scrollHeight);}function Q(o,i,c){return `
            <div class="aicommerce-audio-player" data-message-index="${i}">
                <button class="aicommerce-audio-btn">
                     <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                </button>
                <div class="aicommerce-audio-waveform">
                    <div class="aicommerce-waveform-bars">
                        ${(o.waveformBars||Array(40).fill(10)).map(d=>`
                            <div class="aicommerce-waveform-bar" style="height: ${d}%; background-color: ${c?"rgba(255,255,255,0.4)":"rgba(99,102,241,0.3)"}"></div>
                        `).join("")}
                    </div>
                    <div class="aicommerce-audio-time">
                        <span class="aicommerce-current-time">0:00</span>
                        <span>${K(o.audioDuration||0)}</span>
                    </div>
                </div>
                <audio src="${o.audioUrl}" preload="metadata"></audio>
            </div>
        `}function Z(){if(!a)return;let o=a.querySelector(".aicommerce-launcher");o&&o.addEventListener("click",()=>M());let i=a.querySelector(".aicommerce-close");i&&i.addEventListener("click",()=>q());let c=a.querySelector(".aicommerce-input"),d=a.querySelector(".aicommerce-send");c&&c.addEventListener("keypress",n=>{n.key==="Enter"&&c.value.trim()&&(A(c.value.trim()),c.value="");}),d&&c&&d.addEventListener("click",()=>{c.value.trim()&&(A(c.value.trim()),c.value="");});let u=a.querySelector(".aicommerce-mic");u&&u.addEventListener("click",()=>ee()),a.querySelectorAll(".aicommerce-product-card").forEach(n=>{n.addEventListener("click",()=>{let m=n.getAttribute("data-product-id"),f=r.messages.flatMap(x=>x.products||[]).find(x=>x.id===m);f&&(l.onProductClick?l.onProductClick(f):f.url&&window.open(f.url,"_blank","noopener,noreferrer"));});}),a.querySelectorAll(".aicommerce-products").forEach(n=>{let m=false,f=0,x=0;n.addEventListener("mousedown",k=>{m=true,n.style.cursor="grabbing",f=k.pageX-n.offsetLeft,x=n.scrollLeft;}),n.addEventListener("mouseleave",()=>{m=false,n.style.cursor="grab";}),n.addEventListener("mouseup",()=>{m=false,n.style.cursor="grab";}),n.addEventListener("mousemove",k=>{if(!m)return;k.preventDefault();let v=(k.pageX-n.offsetLeft-f)*2;n.scrollLeft=x-v;});}),a.querySelectorAll(".aicommerce-audio-player").forEach(n=>{let m=n.querySelector("audio"),f=n.querySelector(".aicommerce-audio-btn"),x=n.querySelectorAll(".aicommerce-waveform-bar"),k=n.querySelector(".aicommerce-current-time");if(!m||!f)return;f.addEventListener("click",()=>{!m.paused?(m.pause(),f.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>'):(a?.querySelectorAll("audio").forEach(w=>{if(w!==m&&!w.paused){w.pause();let $=w.closest(".aicommerce-audio-player")?.querySelector(".aicommerce-audio-btn");$&&($.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>');}}),m.play(),f.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>');}),m.addEventListener("timeupdate",()=>{if(k&&(k.textContent=K(m.currentTime)),m.duration){let v=m.currentTime/m.duration*100;x.forEach((w,U)=>{U/x.length*100<=v?w.style.backgroundColor=n.closest(".aicommerce-user")?"rgba(255,255,255,1)":"var(--aic-primary)":w.style.backgroundColor=n.closest(".aicommerce-user")?"rgba(255,255,255,0.4)":"rgba(99,102,241,0.3)";});}}),m.addEventListener("ended",()=>{f.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>';});let S=n.querySelector(".aicommerce-waveform-bars");S&&S.addEventListener("click",v=>{let w=S.getBoundingClientRect(),$=(v.clientX-w.left)/w.width;m.duration&&(m.currentTime=$*m.duration);});});}async function ee(){if(r.isRecording)s&&s.state!=="inactive"&&s.stop();else try{let o=await navigator.mediaDevices.getUserMedia({audio:!0});g=[],s=new MediaRecorder(o,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"}),s.ondataavailable=i=>{i.data.size>0&&g.push(i.data);},s.onstop=async()=>{if(o.getTracks().forEach(i=>i.stop()),g.length>0){let i=new Blob(g,{type:s?.mimeType||"audio/webm"});await re(i);}r.isRecording=!1,y();},s.start(),r.isRecording=!0,y();}catch(o){console.error("Failed to start recording:",o),r.messages.push({role:"assistant",content:"Unable to access microphone. Please check your permissions."}),y();}}async function re(o){let i=URL.createObjectURL(o),c=Array(40).fill(10),d=0;try{c=await oe(o);let u=new Audio(i);await new Promise(P=>{u.onloadedmetadata=()=>{d=u.duration,P();},u.onerror=()=>P();});}catch(u){console.error("Audio analysis failed",u);}r.messages.push({role:"user",content:"Voice message",audioUrl:i,audioDuration:d,waveformBars:c}),r.isLoading=true,y();try{let u=await e.chatWithAudio(o);return r.messages.push({role:"assistant",content:u.reply,products:u.products}),l.onMessage&&l.onMessage("Voice message",u),u}catch(u){throw r.messages.push({role:"assistant",content:"Sorry, I encountered an error processing your voice message. Please try again."}),u}finally{r.isLoading=false,y();}}function te(o){return /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/.test(o)}function K(o){let i=Math.floor(o/60),c=Math.floor(o%60);return `${i}:${c.toString().padStart(2,"0")}`}async function oe(o){try{let i=new(window.AudioContext||window.webkitAudioContext),c=await o.arrayBuffer(),u=(await i.decodeAudioData(c)).getChannelData(0),P=40,T=Math.floor(u.length/P),h=[];for(let n=0;n<P;n++){let m=n*T,f=m+T,x=0;for(let v=m;v<f;v++)u[v]&&(x+=u[v]*u[v]);let k=Math.sqrt(x/T),S=Math.min(100,Math.max(10,k*400));h.push(S);}return h}catch(i){return console.error("Analysis error",i),Array.from({length:40},()=>20+Math.random()*60)}}async function A(o){r.messages.push({role:"user",content:o}),r.isLoading=true,y();try{let i=await e.chat(o);return r.messages.push({role:"assistant",content:i.reply,products:i.products}),l.onMessage&&l.onMessage(o,i),i}catch(i){throw r.messages.push({role:"assistant",content:"Sorry, I encountered an error. Please try again."}),i}finally{r.isLoading=false,y();}}function M(){r.isOpen=true,y(),l.onOpen?.(),setTimeout(()=>{a?.querySelector(".aicommerce-input")?.focus();},100);}function q(){r.isOpen=false,y(),l.onClose?.();}function ie(){r.isOpen?q():M();}function ae(){a&&(a.remove(),a=null),b&&(b.remove(),b=null);}function se(o){if(Object.assign(l,o),o.primaryColor){let i=H(l);b&&(b.textContent=i);}y();}function R(o){let i=document.createElement("div");return i.textContent=o,i.innerHTML}function ne(o,i){let d={USD:"$",EUR:"\u20AC",GBP:"\xA3",MAD:"DH",SAR:"SAR",AED:"AED",JPY:"\xA5",CNY:"\xA5"}[i||"USD"]||i||"$";return `${o.toFixed(2)} ${d}`}return G(),{open:M,close:q,toggle:ie,destroy:ae,sendMessage:A,updateConfig:se}}exports.AICommerceWidget=void 0;var F=B(()=>{L();V();exports.AICommerceWidget={init:j,VERSION:"1.0.0"};typeof window<"u"&&(window.AICommerceWidget=exports.AICommerceWidget);});L();F();var be="1.0.0";typeof window<"u"&&(window.AICommerce=(L(),W(D)).AICommerce,window.AICommerceError=(L(),W(D)).AICommerceError,window.AICommerceWidget=(F(),W(X)).AICommerceWidget);exports.VERSION=be;exports.createWidget=j;return exports;})({});//# sourceMappingURL=index.min.js.map
//# sourceMappingURL=index.min.js.map